{"version":3,"file":"ogc.esm.js","sources":["../src/wmsmaptype.ts"],"sourcesContent":["/**\n * Copyright 2019 Google LLC. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/// <reference types=\"@types/googlemaps\" />\nimport { stringify } from \"query-string\";\n\n/**\n * @ignore\n */\nconst DEFAULT_WMS_PARAMS = {\n  request: \"GetMap\",\n  service: \"WMS\",\n  srs: \"EPSG:3857\"\n};\n\n/**\n * @ignore\n */\nconst EPSG_3857_EXTENT = 20037508.34789244;\n\n/**\n * @ignore\n */\nconst ORIG_X = -EPSG_3857_EXTENT; // x starts from right\n\n/**\n * @ignore\n */\nconst ORIG_Y = EPSG_3857_EXTENT; // y starts from top\n\n/**\n * Convert xyz tile coordinates to mercator bounds.\n *\n * @param x\n * @param y\n * @param zoom\n * @returns {number[]} minx, miny, maxx, maxy\n */\nfunction xyzToBounds(x: number, y: number, zoom: number): number[] {\n  const tileSize = (EPSG_3857_EXTENT * 2) / Math.pow(2, zoom);\n  const minx = ORIG_X + x * tileSize;\n  const maxx = ORIG_X + (x + 1) * tileSize;\n  const miny = ORIG_Y - (y + 1) * tileSize;\n  const maxy = ORIG_Y - y * tileSize;\n  return [minx, miny, maxx, maxy];\n}\n\ninterface WmsMapTypeOptions {\n  url: string;\n  layers: string;\n  maxZoom: number;\n  styles?: string;\n  bgcolor?: string;\n  version?: string;\n  transparent?: boolean;\n  format?: string;\n  outline?: boolean;\n  name?: string;\n  alt?: string;\n  minZoom?: number;\n  opacity?: number;\n}\n\n/**\n *\n * @param {WmsMapTypeOptions} params\n */\nconst WmsMapType = function({\n  url,\n  layers,\n  styles = \"\",\n  bgcolor = \"0xFFFFFF\",\n  version = \"1.1.1\",\n  transparent = true,\n  format = \"image/png\",\n  outline = false,\n  // google.maps.ImageMapTypeOptions interface\n  name,\n  alt,\n  maxZoom,\n  minZoom,\n  opacity\n}: WmsMapTypeOptions): google.maps.ImageMapType {\n  // currently only support tileSize of 256\n  const tileSize = new google.maps.Size(256, 256);\n\n  const params = {\n    layers,\n    styles,\n    version,\n    transparent,\n    bgcolor,\n    format,\n    outline,\n    width: tileSize.width,\n    height: tileSize.height,\n    ...DEFAULT_WMS_PARAMS\n  };\n\n  if (url.slice(-1) !== \"?\") {\n    url += \"?\";\n  }\n\n  const getTileUrl = function(coord: google.maps.Point, zoom: number): string {\n    return (\n      url +\n      stringify({\n        bbox: xyzToBounds(coord.x, coord.y, zoom).join(\",\"),\n        ...params\n      })\n    );\n  };\n\n  return new google.maps.ImageMapType({\n    getTileUrl,\n    name,\n    alt,\n    opacity,\n    maxZoom,\n    minZoom,\n    tileSize\n  });\n};\n\nexport {\n  EPSG_3857_EXTENT,\n  DEFAULT_WMS_PARAMS,\n  xyzToBounds,\n  WmsMapType,\n  WmsMapTypeOptions\n};\n"],"names":[],"mappings":";;AAAA;;;;;;;;;;;;;;;AAgBA,AAGA;;;AAGA,MAAM,kBAAkB,GAAG;IACzB,OAAO,EAAE,QAAQ;IACjB,OAAO,EAAE,KAAK;IACd,GAAG,EAAE,WAAW;CACjB,CAAC;;;;AAKF,MAAM,gBAAgB,GAAG,iBAAiB,CAAC;;;;AAK3C,MAAM,MAAM,GAAG,CAAC,gBAAgB,CAAC;;;;AAKjC,MAAM,MAAM,GAAG,gBAAgB,CAAC;;;;;;;;;AAUhC,SAAS,WAAW,CAAC,CAAS,EAAE,CAAS,EAAE,IAAY;IACrD,MAAM,QAAQ,GAAG,CAAC,gBAAgB,GAAG,CAAC,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;IAC5D,MAAM,IAAI,GAAG,MAAM,GAAG,CAAC,GAAG,QAAQ,CAAC;IACnC,MAAM,IAAI,GAAG,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC;IACzC,MAAM,IAAI,GAAG,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC;IACzC,MAAM,IAAI,GAAG,MAAM,GAAG,CAAC,GAAG,QAAQ,CAAC;IACnC,OAAO,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;CACjC;;;;;AAsBD,MAAM,UAAU,GAAG,UAAS,EAC1B,GAAG,EACH,MAAM,EACN,MAAM,GAAG,EAAE,EACX,OAAO,GAAG,UAAU,EACpB,OAAO,GAAG,OAAO,EACjB,WAAW,GAAG,IAAI,EAClB,MAAM,GAAG,WAAW,EACpB,OAAO,GAAG,KAAK;;AAEf,IAAI,EACJ,GAAG,EACH,OAAO,EACP,OAAO,EACP,OAAO,EACW;;IAElB,MAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;IAEhD,MAAM,MAAM,mBACV,MAAM;QACN,MAAM;QACN,OAAO;QACP,WAAW;QACX,OAAO;QACP,MAAM;QACN,OAAO,EACP,KAAK,EAAE,QAAQ,CAAC,KAAK,EACrB,MAAM,EAAE,QAAQ,CAAC,MAAM,IACpB,kBAAkB,CACtB,CAAC;IAEF,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;QACzB,GAAG,IAAI,GAAG,CAAC;KACZ;IAED,MAAM,UAAU,GAAG,UAAS,KAAwB,EAAE,IAAY;QAChE,QACE,GAAG;YACH,SAAS,iBACP,IAAI,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,IAChD,MAAM,EACT,EACF;KACH,CAAC;IAEF,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;QAClC,UAAU;QACV,IAAI;QACJ,GAAG;QACH,OAAO;QACP,OAAO;QACP,OAAO;QACP,QAAQ;KACT,CAAC,CAAC;CACJ;;;;"}