{"code":"/**\r\n * Copyright 2019 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/// <reference types=\"@types/googlemaps\" />\r\nexport class Loader {\r\n    constructor({ apiKey, libraries = [], channel, language, clientId, region, version }) {\r\n        this.CALLBACK = \"__google_maps_callback\";\r\n        this.URL = \"https://maps.googleapis.com/maps/api/js\";\r\n        this.callbacks = [];\r\n        this.done = false;\r\n        this.loading = false;\r\n        this.version = version;\r\n        this.apiKey = apiKey;\r\n        this.libraries = libraries;\r\n        this.channel = channel;\r\n        this.language = language;\r\n        this.clientId = clientId;\r\n        this.region = region;\r\n    }\r\n    createUrl() {\r\n        let url = this.URL;\r\n        url += \"?callback=\" + this.CALLBACK;\r\n        if (this.apiKey) {\r\n            url += \"&key=\" + this.apiKey;\r\n        }\r\n        if (this.libraries.length > 0) {\r\n            url += \"&libraries=\" + this.libraries.join(\",\");\r\n        }\r\n        if (this.clientId) {\r\n            url += \"&client=\" + this.clientId;\r\n        }\r\n        if (this.channel) {\r\n            url += \"&channel=\" + this.channel;\r\n        }\r\n        if (this.language) {\r\n            url += \"&language=\" + this.language;\r\n        }\r\n        if (this.region) {\r\n            url += \"&region=\" + this.region;\r\n        }\r\n        if (this.version) {\r\n            url += \"&v=\" + this.version;\r\n        }\r\n        return url;\r\n    }\r\n    load() {\r\n        return this.loadPromise();\r\n    }\r\n    loadPromise() {\r\n        return new Promise((resolve, reject) => {\r\n            this.loadCallback((err) => {\r\n                if (!err) {\r\n                    resolve();\r\n                }\r\n                else {\r\n                    reject(err);\r\n                }\r\n            });\r\n        });\r\n    }\r\n    loadCallback(fn) {\r\n        this.callbacks.push(fn);\r\n        this.execute();\r\n    }\r\n    setScript() {\r\n        const url = this.createUrl();\r\n        const script = document.createElement(\"script\");\r\n        script.type = \"text/javascript\";\r\n        script.src = url;\r\n        script.onerror = this.loadErrorCallback;\r\n        script.defer = true;\r\n        script.async = true;\r\n        document.head.appendChild(script);\r\n    }\r\n    loadErrorCallback(e) {\r\n        this.onerrorEvent = e;\r\n        this.callback();\r\n    }\r\n    setCallback() {\r\n        window[this.CALLBACK] = this.callback.bind(this);\r\n    }\r\n    callback() {\r\n        this.done = true;\r\n        this.loading = false;\r\n        this.callbacks.forEach(cb => {\r\n            cb(this.onerrorEvent);\r\n        });\r\n        this.callbacks = [];\r\n    }\r\n    execute() {\r\n        if (this.done) {\r\n            this.callback();\r\n        }\r\n        else {\r\n            if (this.loading) {\r\n                // do nothing but wait\r\n            }\r\n            else {\r\n                this.loading = true;\r\n                this.setCallback();\r\n                this.setScript();\r\n            }\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=loader.js.map","references":[],"map":"{\"version\":3,\"file\":\"loader.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/loader.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/travis/build/googlemaps/v3-utility-library/packages/loader/loader.d.ts","writeByteOrderMark":false,"text":"/**\r\n * Copyright 2019 Google LLC. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nexport interface LoaderOptions {\r\n    apiKey: string;\r\n    version?: string;\r\n    libraries?: string[];\r\n    channel?: string;\r\n    language?: string;\r\n    clientId?: string;\r\n    region?: string;\r\n}\r\nexport declare class Loader {\r\n    version: string;\r\n    apiKey: string;\r\n    libraries: string[];\r\n    channel: string;\r\n    language: string;\r\n    clientId: string;\r\n    region: string;\r\n    private CALLBACK;\r\n    private URL;\r\n    private callbacks;\r\n    private done;\r\n    private loading;\r\n    private onerrorEvent;\r\n    constructor({ apiKey, libraries, channel, language, clientId, region, version }: LoaderOptions);\r\n    createUrl(): string;\r\n    load(): Promise<void>;\r\n    loadPromise(): Promise<any>;\r\n    loadCallback(fn: (e: Event) => any): void;\r\n    private setScript;\r\n    private loadErrorCallback;\r\n    private setCallback;\r\n    private callback;\r\n    private execute;\r\n}\r\n"}}
