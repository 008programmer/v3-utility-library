this.google=this.google||{},this.google.maps=this.google.maps||{},this.google.maps.plugins=this.google.maps.plugins||{},this.google.maps.plugins.markermanager=function(t){"use strict";function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function s(t,i){for(var s=0;s<i.length;s++){var h=i[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function h(t,i,h){return i&&s(t.prototype,i),h&&s(t,h),t}var e=function(){function t(s,h){i(this,t),this.z=h,this.minX=Math.min(s[0].x,s[1].x),this.maxX=Math.max(s[0].x,s[1].x),this.minY=Math.min(s[0].y,s[1].y),this.maxY=Math.max(s[0].y,s[1].y)}return h(t,[{key:"equals",value:function(t){return this.maxX===t.maxX&&this.maxY===t.maxY&&this.minX===t.minX&&this.minY===t.minY}},{key:"containsPoint",value:function(t){return this.minX<=t.x&&this.maxX>=t.x&&this.minY<=t.y&&this.maxY>=t.y}}]),t}(),n=function(){function t(s,h){var e=this,n=h.maxZoom,o=void 0===n?19:n,r=h.trackMarkers,a=h.shown,u=void 0===a||a,l=h.borderPadding,v=void 0===l?100:l;i(this,t),this.t=1024,this.i=s,this.s=s.getZoom(),this.h=o,this.o=r,this.u=new google.maps.Size(-v,v),this.l=new google.maps.Size(v,-v),this.v={},this.g=[],this.g[this.h]=[],this.k={},this.k[this.h]=0,this.shownMarkers=0,this.shown=u,google.maps.event.addListenerOnce(s,"idle",(function(){e.M()}))}return h(t,[{key:"_initialize",value:function(){var t=this.i.mapTypes;for(var i in t)i in t&&t.get(i)&&"number"===t.get(i).maxZoom&&this.i.mapTypes.get(i).maxZoom;google.maps.event.addListener(this.i,"dragend",this._.bind(this)),google.maps.event.addListener(this.i,"idle",this._.bind(this)),google.maps.event.addListener(this.i,"zoom_changed",this._.bind(this)),this.resetManager(),this.m=this.C(),google.maps.event.trigger(this,"loaded")}},{key:"_removeOverlay",value:function(t){t.setMap(null),this.shownMarkers--}},{key:"_addOverlay",value:function(t){this.shown&&(t.setMap(this.i),this.shownMarkers++)}},{key:"resetManager",value:function(){for(var t=256,i=0;i<=this.h;++i)this.g[i]=[],this.k[i]=0,this.v[i]=Math.ceil(t/this.t),t<<=1}},{key:"clearMarkers",value:function(){this.p(this.m,this.G.bind(this)),this.resetManager()}},{key:"_getTilePoint",value:function(t,i,s){var h=function(t,i){return new google.maps.Point(~~(.5+(e=t.lng(),(1+e/180)*(2<<i+6))),~~(.5+(s=t.lat(),h=Math.sin(s*Math.PI/180),(1-.5/Math.PI*Math.log((1+h)/(1-h)))*(2<<i+6))));var s,h,e}(t,i);return new google.maps.Point(Math.floor((h.x+s.width)/this.t),Math.floor((h.y+s.height)/this.t))}},{key:"_addMarkerBatch",value:function(t,i,s){var h=t.getPosition();t.set("__minZoom",i),this.o&&google.maps.event.addListener(t,"changed",(function(t,i,s){this.O(t,i,s)}));for(var e=this.B(h,s,new google.maps.Size(0,0)),n=s;n>=i;n--)this.P(e.x,e.y,n).push(t),e.x=e.x>>1,e.y=e.y>>1}},{key:"_isGridPointVisible",value:function(t){var i=this.m.minY<=t.y&&t.y<=this.m.maxY,s=this.m.minX,h=s<=t.x&&t.x<=this.m.maxX;if(!h&&s<0){var e=this.v[this.m.z];h=s+e<=t.x&&t.x<=e-1}return i&&h}},{key:"_onMarkerMoved",value:function(t,i,s){for(var h=this.h,e=!1,n=this.B(i,h,new google.maps.Size(0,0)),o=this.B(s,h,new google.maps.Size(0,0));h>=0&&(n.x!==o.x||n.y!==o.y);){var r=this.Z(n.x,n.y,h);r&&this.D(r,t)&&this.P(o.x,o.y,h).push(t),h===this.s&&(this.T(n)?this.T(o)||(this.G(t),e=!0):this.T(o)&&(this.j(t),e=!0)),n.x=n.x>>1,n.y=n.y>>1,o.x=o.x>>1,o.y=o.y>>1,--h}e&&this.q()}},{key:"removeMarker",value:function(t){for(var i=this.h,s=!1,h=t.getPosition(),e=this.B(h,i,new google.maps.Size(0,0));i>=0;){var n=this.Z(e.x,e.y,i);n&&this.D(n,t),i===this.s&&this.T(e)&&(this.G(t),s=!0),e.x=e.x>>1,e.y=e.y>>1,--i}s&&this.q(),this.k[t.get("__minZoom")]--}},{key:"addMarkers",value:function(t,i,s){s=this.A(s);for(var h=t.length-1;h>=0;h--)this.F(t[h],i,s);this.k[i]+=t.length}},{key:"_getOptmaxZoom",value:function(t){return t||this.h}},{key:"getMarkerCount",value:function(t){for(var i=0,s=0;s<=t;s++)i+=this.k[s];return i}},{key:"getMarker",value:function(t,i,s){var h=new google.maps.LatLng(t,i),e=this.B(h,s,new google.maps.Size(0,0)),n=new google.maps.Marker({position:h}),o=this.Z(e.x,e.y,s);if(void 0!==o)for(var r=0;r<o.length;r++)t===o[r].getPosition().lat()&&i===o[r].getPosition().lng()&&(n=o[r]);return n}},{key:"addMarker",value:function(t,i,s){s=this.A(s),this.F(t,i,s);var h=this.B(t.getPosition(),this.s,new google.maps.Size(0,0));this.T(h)&&i<=this.m.z&&this.m.z<=s&&(this.j(t),this.q()),this.k[i]++}},{key:"_getGridCellCreate",value:function(t,i,s){return t<0&&(t+=this.v[s]),this.g[s]||(this.g[s]=[]),this.g[s][t]||(this.g[s][t]=[]),this.g[s][t][i]||(this.g[s][t][i]=[]),this.g[s][t][i]}},{key:"_getGridCellNoCreate",value:function(t,i,s){return t<0&&(t+=this.v[s]),this.g[s]&&this.g[s][t]&&this.g[s][t][i]?this.g[s][t][i]:null}},{key:"_getGridBounds",value:function(t,i,s,h){i=Math.min(i,this.h);var n=t.getSouthWest(),o=t.getNorthEast(),r=this.B(n,i,s),a=this.B(o,i,h),u=this.v[i];(o.lng()<n.lng()||a.x<r.x)&&(r.x-=u),a.x-r.x+1>=u&&(r.x=0,a.x=u-1);var l=new e([r,a],i);return l.z=i,l}},{key:"_getMapGridBounds",value:function(){return this.H(this.i.getBounds(),this.s,this.u,this.l)}},{key:"_onMapMoveEnd",value:function(){window.setTimeout(this.L.bind(this),0)}},{key:"visible",value:function(){return!!this.shown}},{key:"isHidden",value:function(){return!this.shown}},{key:"show",value:function(){this.shown=!0,this.refresh()}},{key:"hide",value:function(){this.shown=!1,this.refresh()}},{key:"toggle",value:function(){this.shown=!this.shown,this.refresh()}},{key:"refresh",value:function(){this.shownMarkers>0&&this.p(this.m,this.G.bind(this)),this.show&&this.p(this.m,this.j.bind(this)),this.q()}},{key:"_updateMarkers",value:function(){this.s=this.i.getZoom();var t=this.C();t.equals(this.m)&&t.z===this.m.z||(t.z!==this.m.z?(this.p(this.m,this.G.bind(this)),this.show&&this.p(t,this.j.bind(this))):(this.N(this.m,t,this.V.bind(this)),this.show&&this.N(t,this.m,this.I.bind(this))),this.m=t,this.q())}},{key:"_notifyListeners",value:function(){google.maps.event.trigger(this,"changed",this.m,this.shownMarkers)}},{key:"_processAll",value:function(t,i){for(var s=t.minX;s<=t.maxX;s++)for(var h=t.minY;h<=t.maxY;h++)this.J(s,h,t.z,i)}},{key:"_processCellMarkers",value:function(t,i,s,h){var e=this.Z(t,i,s);if(e)for(var n=e.length-1;n>=0;n--)h(e[n])}},{key:"_removeCellMarkers",value:function(t,i,s){this.J(t,i,s,this.G.bind(this))}},{key:"_addCellMarkers",value:function(t,i,s){this.J(t,i,s,this.j.bind(this))}},{key:"_rectangleDiff",value:function(t,i,s){this.K(t,i,(function(i,h){s(i,h,t.z)}))}},{key:"_rectangleDiffCoords",value:function(t,i,s){var h,e,n=t.minX,o=t.minY,r=t.maxX,a=t.maxY,u=i.minX,l=i.minY,v=i.maxX,f=i.maxY;for(h=n;h<=r;h++){for(e=o;e<=a&&e<l;e++)s(h,e);for(e=Math.max(f+1,o);e<=a;e++)s(h,e)}for(e=Math.max(o,l);e<=Math.min(a,f);e++){for(h=Math.min(r+1,u)-1;h>=n;h--)s(h,e);for(h=Math.max(n,v+1);h<=r;h++)s(h,e)}}},{key:"_removeMarkerFromCell",value:function(t,i){for(var s=0,h=0;h<t.length;++h)t[h]===i&&(t.splice(h--,1),s++);return s}}]),t}();return t.MarkerManager=n,t}({});
