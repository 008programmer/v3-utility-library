!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(((t=t||self).google=t.google||{},t.google.maps=t.google.maps||{},t.google.maps.plugins=t.google.maps.plugins||{},t.google.maps.plugins.markermanager={}))}(this,(function(t){"use strict";function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function s(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function e(t,i,e){return i&&s(t.prototype,i),e&&s(t,e),t}var h=function(){function t(s,e){i(this,t),this.z=e,this.minX=Math.min(s[0].x,s[1].x),this.maxX=Math.max(s[0].x,s[1].x),this.minY=Math.min(s[0].y,s[1].y),this.maxY=Math.max(s[0].y,s[1].y)}return e(t,[{key:"equals",value:function(t){return this.maxX===t.maxX&&this.maxY===t.maxY&&this.minX===t.minX&&this.minY===t.minY}},{key:"containsPoint",value:function(t){return this.minX<=t.x&&this.maxX>=t.x&&this.minY<=t.y&&this.maxY>=t.y}}]),t}(),n=function(){function t(s,e){var h=this,n=e.maxZoom,o=void 0===n?19:n,r=e.trackMarkers,a=e.shown,u=void 0===a||a,l=e.borderPadding,f=void 0===l?100:l;i(this,t),this.t=1024,this.i=s,this.s=s.getZoom(),this.h=o,this.o=r,this.u=new google.maps.Size(-f,f),this.l=new google.maps.Size(f,-f),this.v={},this.g=[],this.g[this.h]=[],this.k={},this.k[this.h]=0,this.shownMarkers=0,this.shown=u,google.maps.event.addListenerOnce(s,"idle",(function(){h.M()}))}return e(t,[{key:"_initialize",value:function(){var t=this.i.mapTypes;for(var i in t)i in t&&t.get(i)&&"number"===t.get(i).maxZoom&&this.i.mapTypes.get(i).maxZoom;google.maps.event.addListener(this.i,"dragend",this._.bind(this)),google.maps.event.addListener(this.i,"idle",this._.bind(this)),google.maps.event.addListener(this.i,"zoom_changed",this._.bind(this)),this.resetManager(),this.m=this.p(),google.maps.event.trigger(this,"loaded")}},{key:"_removeOverlay",value:function(t){t.setMap(null),this.shownMarkers--}},{key:"_addOverlay",value:function(t){this.shown&&(t.setMap(this.i),this.shownMarkers++)}},{key:"resetManager",value:function(){for(var t=256,i=0;i<=this.h;++i)this.g[i]=[],this.k[i]=0,this.v[i]=Math.ceil(t/this.t),t<<=1}},{key:"clearMarkers",value:function(){this.C(this.m,this.G.bind(this)),this.resetManager()}},{key:"_getTilePoint",value:function(t,i,s){var e=function(t,i){return new google.maps.Point(~~(.5+(h=t.lng(),(1+h/180)*(2<<i+6))),~~(.5+(s=t.lat(),e=Math.sin(s*Math.PI/180),(1-.5/Math.PI*Math.log((1+e)/(1-e)))*(2<<i+6))));var s,e,h}(t,i);return new google.maps.Point(Math.floor((e.x+s.width)/this.t),Math.floor((e.y+s.height)/this.t))}},{key:"_addMarkerBatch",value:function(t,i,s){var e=t.getPosition();t.set("__minZoom",i),this.o&&google.maps.event.addListener(t,"changed",(function(t,i,s){this.O(t,i,s)}));for(var h=this.j(e,s,new google.maps.Size(0,0)),n=s;n>=i;n--)this.B(h.x,h.y,n).push(t),h.x=h.x>>1,h.y=h.y>>1}},{key:"_isGridPointVisible",value:function(t){var i=this.m.minY<=t.y&&t.y<=this.m.maxY,s=this.m.minX,e=s<=t.x&&t.x<=this.m.maxX;if(!e&&s<0){var h=this.v[this.m.z];e=s+h<=t.x&&t.x<=h-1}return i&&e}},{key:"_onMarkerMoved",value:function(t,i,s){for(var e=this.h,h=!1,n=this.j(i,e,new google.maps.Size(0,0)),o=this.j(s,e,new google.maps.Size(0,0));e>=0&&(n.x!==o.x||n.y!==o.y);){var r=this.P(n.x,n.y,e);r&&this.Z(r,t)&&this.B(o.x,o.y,e).push(t),e===this.s&&(this.D(n)?this.D(o)||(this.G(t),h=!0):this.D(o)&&(this.T(t),h=!0)),n.x=n.x>>1,n.y=n.y>>1,o.x=o.x>>1,o.y=o.y>>1,--e}h&&this.q()}},{key:"removeMarker",value:function(t){for(var i=this.h,s=!1,e=t.getPosition(),h=this.j(e,i,new google.maps.Size(0,0));i>=0;){var n=this.P(h.x,h.y,i);n&&this.Z(n,t),i===this.s&&this.D(h)&&(this.G(t),s=!0),h.x=h.x>>1,h.y=h.y>>1,--i}s&&this.q(),this.k[t.get("__minZoom")]--}},{key:"addMarkers",value:function(t,i,s){s=this.A(s);for(var e=t.length-1;e>=0;e--)this.F(t[e],i,s);this.k[i]+=t.length}},{key:"_getOptmaxZoom",value:function(t){return t||this.h}},{key:"getMarkerCount",value:function(t){for(var i=0,s=0;s<=t;s++)i+=this.k[s];return i}},{key:"getMarker",value:function(t,i,s){var e=new google.maps.LatLng(t,i),h=this.j(e,s,new google.maps.Size(0,0)),n=new google.maps.Marker({position:e}),o=this.P(h.x,h.y,s);if(void 0!==o)for(var r=0;r<o.length;r++)t===o[r].getPosition().lat()&&i===o[r].getPosition().lng()&&(n=o[r]);return n}},{key:"addMarker",value:function(t,i,s){s=this.A(s),this.F(t,i,s);var e=this.j(t.getPosition(),this.s,new google.maps.Size(0,0));this.D(e)&&i<=this.m.z&&this.m.z<=s&&(this.T(t),this.q()),this.k[i]++}},{key:"_getGridCellCreate",value:function(t,i,s){return t<0&&(t+=this.v[s]),this.g[s]||(this.g[s]=[]),this.g[s][t]||(this.g[s][t]=[]),this.g[s][t][i]||(this.g[s][t][i]=[]),this.g[s][t][i]}},{key:"_getGridCellNoCreate",value:function(t,i,s){return t<0&&(t+=this.v[s]),this.g[s]&&this.g[s][t]&&this.g[s][t][i]?this.g[s][t][i]:null}},{key:"_getGridBounds",value:function(t,i,s,e){i=Math.min(i,this.h);var n=t.getSouthWest(),o=t.getNorthEast(),r=this.j(n,i,s),a=this.j(o,i,e),u=this.v[i];(o.lng()<n.lng()||a.x<r.x)&&(r.x-=u),a.x-r.x+1>=u&&(r.x=0,a.x=u-1);var l=new h([r,a],i);return l.z=i,l}},{key:"_getMapGridBounds",value:function(){return this.H(this.i.getBounds(),this.s,this.u,this.l)}},{key:"_onMapMoveEnd",value:function(){window.setTimeout(this.L.bind(this),0)}},{key:"visible",value:function(){return!!this.shown}},{key:"isHidden",value:function(){return!this.shown}},{key:"show",value:function(){this.shown=!0,this.refresh()}},{key:"hide",value:function(){this.shown=!1,this.refresh()}},{key:"toggle",value:function(){this.shown=!this.shown,this.refresh()}},{key:"refresh",value:function(){this.shownMarkers>0&&this.C(this.m,this.G.bind(this)),this.show&&this.C(this.m,this.T.bind(this)),this.q()}},{key:"_updateMarkers",value:function(){this.s=this.i.getZoom();var t=this.p();t.equals(this.m)&&t.z===this.m.z||(t.z!==this.m.z?(this.C(this.m,this.G.bind(this)),this.show&&this.C(t,this.T.bind(this))):(this.N(this.m,t,this.V.bind(this)),this.show&&this.N(t,this.m,this.I.bind(this))),this.m=t,this.q())}},{key:"_notifyListeners",value:function(){google.maps.event.trigger(this,"changed",this.m,this.shownMarkers)}},{key:"_processAll",value:function(t,i){for(var s=t.minX;s<=t.maxX;s++)for(var e=t.minY;e<=t.maxY;e++)this.J(s,e,t.z,i)}},{key:"_processCellMarkers",value:function(t,i,s,e){var h=this.P(t,i,s);if(h)for(var n=h.length-1;n>=0;n--)e(h[n])}},{key:"_removeCellMarkers",value:function(t,i,s){this.J(t,i,s,this.G.bind(this))}},{key:"_addCellMarkers",value:function(t,i,s){this.J(t,i,s,this.T.bind(this))}},{key:"_rectangleDiff",value:function(t,i,s){this.K(t,i,(function(i,e){s(i,e,t.z)}))}},{key:"_rectangleDiffCoords",value:function(t,i,s){var e,h,n=t.minX,o=t.minY,r=t.maxX,a=t.maxY,u=i.minX,l=i.minY,f=i.maxX,v=i.maxY;for(e=n;e<=r;e++){for(h=o;h<=a&&h<l;h++)s(e,h);for(h=Math.max(v+1,o);h<=a;h++)s(e,h)}for(h=Math.max(o,l);h<=Math.min(a,v);h++){for(e=Math.min(r+1,u)-1;e>=n;e--)s(e,h);for(e=Math.max(n,f+1);e<=r;e++)s(e,h)}}},{key:"_removeMarkerFromCell",value:function(t,i){for(var s=0,e=0;e<t.length;++e)t[e]===i&&(t.splice(e--,1),s++);return s}}]),t}();t.MarkerManager=n,Object.defineProperty(t,"R",{value:!0})}));
//# sourceMappingURL=markermanager.umd.js.map
